{% extends "base.html" %}

{% block title %}Dashboard - Calcifer's Tasks{% endblock %}

{% block content %}
<section class="section">
    <div class="container">
        <!-- Header -->
        <div class="level">
            <div class="level-left">
                <div class="level-item">
                    <h1 class="title is-2 has-text-cyan">
                        <i class="fas fa-home mr-3"></i>
                        Castle Overview
                    </h1>
                </div>
            </div>
            <div class="level-right">
                <div class="level-item">
                    <a href="{{ url_for('main.new_todo') }}" class="button cyber-button-primary">
                        <span class="icon">
                            <i class="fas fa-plus"></i>
                        </span>
                        <span>New Task</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="columns">
            <div class="column is-3">
                <div class="cyber-panel has-text-centered">
                    <div class="has-text-cyan is-size-1">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <p class="title is-4 has-text-light">{{ stats.total }}</p>
                    <p class="subtitle is-6 has-text-grey">Total Tasks</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="cyber-panel has-text-centered">
                    <div class="has-text-warning is-size-1">
                        <i class="fas fa-clock"></i>
                    </div>
                    <p class="title is-4 has-text-light">{{ stats.pending }}</p>
                    <p class="subtitle is-6 has-text-grey">Pending</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="cyber-panel has-text-centered">
                    <div class="has-text-info is-size-1">
                        <i class="fas fa-spinner"></i>
                    </div>
                    <p class="title is-4 has-text-light">{{ stats.in_progress }}</p>
                    <p class="subtitle is-6 has-text-grey">In Progress</p>
                </div>
            </div>
            <div class="column is-3">
                <div class="cyber-panel has-text-centered">
                    <div class="has-text-success is-size-1">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <p class="title is-4 has-text-light">{{ stats.completed }}</p>
                    <p class="subtitle is-6 has-text-grey">Completed</p>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="cyber-panel mb-5">
            <div class="level">
                <div class="level-left">
                    <div class="level-item">
                        <div class="field is-grouped">
                            <div class="control">
                                <div class="select cyber-select">
                                    <select id="statusFilter">
                                        <option value="all" {{ 'selected' if current_status == 'all' }}>All Status</option>
                                        <option value="pending" {{ 'selected' if current_status == 'pending' }}>Pending</option>
                                        <option value="in_progress" {{ 'selected' if current_status == 'in_progress' }}>In Progress</option>
                                        <option value="completed" {{ 'selected' if current_status == 'completed' }}>Completed</option>
                                    </select>
                                </div>
                            </div>
                            <div class="control">
                                <div class="select cyber-select">
                                    <select id="priorityFilter">
                                        <option value="all" {{ 'selected' if current_priority == 'all' }}>All Priority</option>
                                        <option value="critical" {{ 'selected' if current_priority == 'critical' }}>Critical</option>
                                        <option value="high" {{ 'selected' if current_priority == 'high' }}>High</option>
                                        <option value="medium" {{ 'selected' if current_priority == 'medium' }}>Medium</option>
                                        <option value="low" {{ 'selected' if current_priority == 'low' }}>Low</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TODO Items -->
        <div class="columns is-multiline">
            {% for todo in todos %}
            <div class="column is-6">
                <div class="cyber-panel todo-item" data-status="{{ todo.status.value }}" data-priority="{{ todo.priority.value }}">
                    <div class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if todo.priority.value == 'critical' %}
                                    <span class="icon has-text-danger">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </span>
                                {% elif todo.priority.value == 'high' %}
                                    <span class="icon has-text-warning">
                                        <i class="fas fa-exclamation-circle"></i>
                                    </span>
                                {% elif todo.priority.value == 'medium' %}
                                    <span class="icon has-text-info">
                                        <i class="fas fa-info-circle"></i>
                                    </span>
                                {% else %}
                                    <span class="icon has-text-grey">
                                        <i class="fas fa-minus-circle"></i>
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="level-right">
                            <div class="level-item">
                                <span class="tag cyber-tag-{{ todo.status.value }}">
                                    {{ todo.status.value.replace('_', ' ').title() }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="title is-5 has-text-light {{ 'has-text-grey line-through' if todo.status.value == 'completed' }}">
                        {{ todo.title }}
                    </h3>
                    
                    {% if todo.description %}
                    <p class="has-text-grey mb-3">{{ todo.description }}</p>
                    {% endif %}
                    
                    {% if todo.due_date %}
                    <p class="is-size-7 {{ 'has-text-danger' if todo.is_overdue else 'has-text-grey' }}">
                        <i class="fas fa-calendar mr-1"></i>
                        Due: {{ todo.due_date.strftime('%Y-%m-%d %H:%M') }}
                        {% if todo.is_overdue %}
                            <span class="tag is-small is-danger ml-2">OVERDUE</span>
                        {% endif %}
                    </p>
                    {% endif %}
                    
                    <div class="field is-grouped mt-4">
                        <div class="control">
                            <form method="POST" action="{{ url_for('main.toggle_todo', id=todo.id) }}" style="display: inline;">
                                <button type="submit" class="button is-small cyber-button-secondary">
                                    {% if todo.status.value == 'completed' %}
                                        <span class="icon"><i class="fas fa-undo"></i></span>
                                        <span>Reopen</span>
                                    {% else %}
                                        <span class="icon"><i class="fas fa-check"></i></span>
                                        <span>Complete</span>
                                    {% endif %}
                                </button>
                            </form>
                        </div>
                        <div class="control">
                            <a href="{{ url_for('main.edit_todo', id=todo.id) }}" class="button is-small is-info">
                                <span class="icon"><i class="fas fa-edit"></i></span>
                                <span>Edit</span>
                            </a>
                        </div>
                        <div class="control">
                            <form method="POST" action="{{ url_for('main.delete_todo', id=todo.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this TODO?');">
                                <button type="submit" class="button is-small is-danger">
                                    <span class="icon"><i class="fas fa-trash"></i></span>
                                    <span>Delete</span>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="column is-12">
                <div class="cyber-panel has-text-centered">
                    <div class="has-text-grey is-size-1 mb-4">
                        <i class="fas fa-robot"></i>
                    </div>
                    <p class="title is-4 has-text-grey">No tasks found</p>
                    <p class="subtitle is-6 has-text-grey">
                        Start by creating your first TODO item
                    </p>
                    <a href="{{ url_for('main.new_todo') }}" class="button cyber-button-primary mt-3">
                        <span class="icon">
                            <i class="fas fa-plus"></i>
                        </span>
                        <span>Create TODO</span>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const statusFilter = document.getElementById('statusFilter');
    const priorityFilter = document.getElementById('priorityFilter');
    
    function updateFilters() {
        const status = statusFilter.value;
        const priority = priorityFilter.value;
        const url = new URL(window.location);
        
        url.searchParams.set('status', status);
        url.searchParams.set('priority', priority);
        
        window.location.href = url.toString();
    }
    
    statusFilter.addEventListener('change', updateFilters);
    priorityFilter.addEventListener('change', updateFilters);
    
    // Auto-hide notifications
    setTimeout(function() {
        const notifications = document.querySelectorAll('.notification');
        notifications.forEach(function(notification) {
            notification.style.display = 'none';
        });
    }, 5000);
    
    // Delete button for notifications
    document.querySelectorAll('.notification .delete').forEach(function(button) {
        button.addEventListener('click', function() {
            this.parentElement.style.display = 'none';
        });
    });
});
</script>
{% endblock %}